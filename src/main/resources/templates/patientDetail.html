<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>í™˜ì ìƒì„¸ ì •ë³´</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .container { max-width: 900px; margin: 0 auto; }
    .info-box, .chart-form { background-color: #f9f9f9; padding: 15px; border-radius: 4px; margin-bottom: 20px; border: 1px solid #eee; }

    /* í¼ ìŠ¤íƒ€ì¼ */
    .chart-form div { margin-bottom: 10px; }
    .chart-form label { display: block; margin-bottom: 5px; font-weight: bold; }
    .chart-form input { width: 100%; padding: 8px; box-sizing: border-box; }

    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
    th { background-color: #f4f4f4; }
    .total-fee { text-align: right; font-size: 1.2em; font-weight: bold; margin-top: 10px; }

    .btn { padding: 8px 12px; text-decoration: none; border-radius: 4px; border: none; cursor: pointer; display: inline-block;}
    .btn-save { background-color: #28a745; color: white; }
    .btn-back { background-color: #6c757d; color: white; }
    .btn-action { background-color: #17a2b8; color: white; margin-left: 5px;}
  </style>
</head>
<body>
<div class="container">
  <h1>ğŸ¥ í™˜ì ìƒì„¸ ì •ë³´</h1>

  <div class="info-box">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <div>
        <p><strong>ì´ë¦„:</strong> <span th:text="${patient.name}"></span></p>
        <p><strong>ë‚˜ì´:</strong> <span th:text="${patient.age}"></span></p>
        <p><strong>ì£¼ìš” ë³‘ëª…:</strong> <span th:text="${patient.disease}"></span></p>

        <p><strong>í˜„ì¬ ìƒíƒœ:</strong>
          <span th:if="${patient.status != null}"
                th:text="${patient.status.displayName}"
                th:style="${patient.status == T(com.example.hospital.entity.PatientStatus).HOSPITALIZED} ? 'color: purple; font-weight: bold;' :
                                       (${patient.status == T(com.example.hospital.entity.PatientStatus).DISCHARGED} ? 'color: gray;' : 'color: black;')"></span>
          <span th:if="${patient.status == null}">ëŒ€ê¸° ì¤‘</span>
        </p>
      </div>

      <div>
        <a th:if="${patient.status != null and patient.status != T(com.example.hospital.entity.PatientStatus).HOSPITALIZED and patient.status != T(com.example.hospital.entity.PatientStatus).DISCHARGED}"
           th:href="@{/patients/hospitalize/{id}(id=${patient.id})}" class="btn btn-action">ì…ì› ì²˜ë¦¬</a>

        <a th:if="${patient.status == null}"
           th:href="@{/patients/hospitalize/{id}(id=${patient.id})}" class="btn btn-action">ì…ì› ì²˜ë¦¬</a>

        <a th:if="${patient.status != null and patient.status == T(com.example.hospital.entity.PatientStatus).HOSPITALIZED}"
           th:href="@{/patients/discharge/{id}(id=${patient.id})}" class="btn btn-action" style="background-color: #6c757d;">í‡´ì› ì²˜ë¦¬</a>
      </div>
    </div>
  </div>

  <div class="chart-form">
    <h3>ì§„ë£Œ ê¸°ë¡ ì¶”ê°€</h3>
    <form th:action="@{/patients/{id}/charts(id=${patient.id})}" method="post">
      <div>
        <label>ì§„ë£Œì¼</label>
        <input type="date" name="chartDate" required />
      </div>
      <div>
        <label>ë‹´ë‹¹ ì˜ì‚¬</label>
        <input type="text" name="doctorName" placeholder="ì˜ì‚¬ ì´ë¦„ ì…ë ¥" required />
      </div>
      <div>
        <label>ì¦ìƒ</label>
        <input type="text" name="symptom" placeholder="ì¦ìƒ ì…ë ¥" required />
      </div>
      <div>
        <label>ì§„ë‹¨</label>
        <input type="text" name="diagnosis" placeholder="ì§„ë‹¨ëª… ì…ë ¥" required />
      </div>
      <div>
        <label>ì²˜ë°©</label>
        <input type="text" name="prescription" placeholder="ì²˜ë°© ë‚´ìš© ì…ë ¥" required />
      </div>
      <div>
        <label>ì§„ë£Œë¹„ (ì›)</label>
        <input type="number" name="fee" placeholder="ê¸ˆì•¡ ì…ë ¥" required />
      </div>
      <button type="submit" class="btn btn-save">ê¸°ë¡ ì¶”ê°€</button>
    </form>
  </div>

  <h2>ì§„ë£Œ ê¸°ë¡ ëª©ë¡</h2>
  <table th:if="${not #lists.isEmpty(charts)}">
    <thead>
    <tr>
      <th>ë‚ ì§œ</th>
      <th>ë‹´ë‹¹ ì˜ì‚¬</th>
      <th>ì¦ìƒ</th>
      <th>ì§„ë‹¨</th>
      <th>ì²˜ë°©</th>
      <th>ì§„ë£Œë¹„</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="chart : ${charts}">
      <td th:text="${chart.chartDate}">2023-10-27</td>
      <td th:text="${chart.doctorName}">ê¹€ì² ìˆ˜</td>
      <td th:text="${chart.symptom}">ê¸°ì¹¨</td>
      <td th:text="${chart.diagnosis}">ê°ê¸°</td>
      <td th:text="${chart.prescription}">ì•½ ì²˜ë°©</td>
      <td th:text="${#numbers.formatInteger(chart.fee, 0, 'COMMA')} + 'ì›'">10,000ì›</td>
    </tr>
    </tbody>
  </table>

  <div class="total-fee" th:if="${not #lists.isEmpty(charts)}">
    ì´ ì§„ë£Œë¹„:
    <span th:text="${#numbers.formatInteger(#aggregates.sum(charts.![fee]), 0, 'COMMA')} + 'ì›'">50,000ì›</span>
  </div>

  <p th:if="${#lists.isEmpty(charts)}">ì§„ë£Œ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>

  <br>
  <a th:href="@{/patients}" class="btn btn-back">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
</div>
</body>
</html>