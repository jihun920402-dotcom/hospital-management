<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>í™˜ì ê´€ë¦¬ ì‹œìŠ¤í…œ - ëª©ë¡</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header-area { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; }

        .input-form { background-color: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 25px; border: 1px solid #ddd; }
        .input-form div { display: inline-block; margin-right: 15px; vertical-align: top; }
        .input-form label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        .input-form input, .input-form select { padding: 10px; border: 1px solid #ccc; border-radius: 4px; }

        .search-form { margin-bottom: 20px; text-align: right; }
        .search-form input { padding: 8px; width: 250px; border: 1px solid #ccc; border-radius: 4px; }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn { padding: 8px 15px; text-decoration: none; border-radius: 4px; border: none; cursor: pointer; display: inline-block; font-size: 0.9em; transition: 0.3s; }
        .btn-save { background-color: #007bff; color: white; }
        .btn-edit { background-color: #ffc107; color: black; }
        .btn-delete { background-color: #dc3545; color: white; }
        .btn-dashboard { background-color: #343a40; color: white; font-weight: bold; }
        .btn-action { background-color: #17a2b8; color: white; }
        .btn-pay { background-color: #28a745; color: white; }
        .btn:hover { opacity: 0.8; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f4f4f4; font-weight: bold; }
        tr:hover { background-color: #f8f9fa; }

        .pagination { text-align: center; margin-top: 30px; }
        .pagination a { padding: 10px 15px; border: 1px solid #ddd; text-decoration: none; color: #333; margin: 0 2px; border-radius: 4px; }
        .pagination .active { background-color: #007bff; color: white; border-color: #007bff; }

        .status-hosp { color: purple; font-weight: bold; }
        .status-dis { color: gray; }
        .pay-done { color: green; font-weight: bold; }
        .pay-not { color: red; font-weight: bold; }
    </style>
</head>
<body>
<div class="container">
    <div class="header-area">
        <h1>ğŸ¥ í™˜ì ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
        <a th:href="@{/patients/dashboard}" class="btn btn-dashboard">ğŸ“Š ëŒ€ì‹œë³´ë“œ ë³´ê¸°</a>
    </div>

    <div class="input-form">
        <h3 th:text="${patient.id == null} ? 'â• í™˜ì ì‹ ê·œ ë“±ë¡' : 'ğŸ“ í™˜ì ì •ë³´ ìˆ˜ì •'">í™˜ì ë“±ë¡</h3>
        <form th:action="@{/patients}" th:object="${patient}" method="post">
            <input type="hidden" th:field="*{id}" />
            <div>
                <label>ì´ë¦„</label>
                <input type="text" th:field="*{name}" placeholder="ì„±í•¨ ì…ë ¥" required/>
            </div>
            <div>
                <label>ë³‘ëª…</label>
                <input type="text" th:field="*{disease}" placeholder="ì£¼ìš” ì¦ìƒ"/>
            </div>
            <div>
                <label>ë‚˜ì´</label>
                <input type="number" th:field="*{age}" placeholder="ì„¸"/>
            </div>
            <div>
                <label>í˜„ì¬ ìƒíƒœ</label>
                <select th:field="*{status}">
                    <option th:each="s : ${T(com.example.hospital.entity.PatientStatus).values()}"
                            th:value="${s}"
                            th:text="${s.displayName}">ìƒíƒœ</option>
                </select>
            </div>
            <div style="margin-top: 25px;">
                <button type="submit" class="btn btn-save" th:text="${patient.id == null} ? 'ë“±ë¡í•˜ê¸°' : 'ìˆ˜ì •ì™„ë£Œ'">ì €ì¥</button>
                <a th:if="${patient.id != null}" th:href="@{/patients}" class="btn btn-edit" style="background-color: #6c757d; color: white;">ì·¨ì†Œ</a>
            </div>
        </form>
    </div>

    <form th:action="@{/patients}" method="get" class="search-form">
        <input type="text" name="keyword" th:value="${keyword}" placeholder="ê²€ìƒ‰í•  í™˜ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
        <button type="submit" class="btn btn-save">ê²€ìƒ‰</button>
    </form>

    <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>ì´ë¦„</th>
            <th>ë³‘ëª…</th>
            <th>ë‚˜ì´</th>
            <th>ìƒíƒœ</th>
            <th>ì…ì›ì¼</th>
            <th>í‡´ì›ì¼</th>
            <th>ì´ ì§„ë£Œë¹„</th>
            <th>ìˆ˜ë‚©ìƒíƒœ</th>
            <th>ê´€ë¦¬ë©”ë‰´</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="p : ${patients.content}">
            <td th:text="${p.id}">1</td>
            <td>
                <a th:href="@{/patients/{id}(id=${p.id})}" th:text="${p.name}" style="color: #007bff; font-weight: bold; text-decoration: none;">í™˜ìëª…</a>
            </td>
            <td th:text="${p.disease}">-</td>
            <td th:text="${p.age}">-</td>
            <td>
                <span th:if="${p.status != null}" th:text="${p.status.displayName}"
                      th:class="${p.status == T(com.example.hospital.entity.PatientStatus).HOSPITALIZED ? 'status-hosp' : (p.status == T(com.example.hospital.entity.PatientStatus).DISCHARGED ? 'status-dis' : '')}"></span>
                <span th:if="${p.status == null}">ëŒ€ê¸°ì¤‘</span>
            </td>
            <td th:text="${p.admissionDate != null ? p.admissionDate : '-'}"></td>
            <td th:text="${p.dischargeDate != null ? p.dischargeDate : '-'}"></td>
            <td th:text="${#numbers.formatInteger(#aggregates.sum(p.charts.![fee]) ?: 0, 0, 'COMMA')} + 'ì›'">0ì›</td>
            <td>
                <span th:text="${p.paid} ? 'ê²°ì œì™„ë£Œ' : 'ë¯¸ë‚©'" th:class="${p.paid ? 'pay-done' : 'pay-not'}"></span>
            </td>
            <td>
                <a th:if="${p.status != T(com.example.hospital.entity.PatientStatus).HOSPITALIZED and p.status != T(com.example.hospital.entity.PatientStatus).DISCHARGED}"
                   th:href="@{/patients/hospitalize/{id}(id=${p.id})}" class="btn btn-action">ì…ì›</a>

                <a th:if="${p.status == T(com.example.hospital.entity.PatientStatus).HOSPITALIZED}"
                   th:href="@{/patients/discharge/{id}(id=${p.id})}" class="btn btn-action" style="background-color: #6c757d;">í‡´ì›</a>

                <a th:if="${!p.paid}" th:href="@{/patients/pay/{id}(id=${p.id})}" class="btn btn-pay" onclick="return confirm('ìˆ˜ë‚© ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ìˆ˜ë‚©</a>

                <a th:href="@{/patients/edit/{id}(id=${p.id})}" class="btn btn-edit">ìˆ˜ì •</a>
                <a th:href="@{/patients/delete/{id}(id=${p.id})}" class="btn btn-delete" onclick="return confirm('ë°ì´í„°ê°€ ì˜êµ¬ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</a>
            </td>
        </tr>
        </tbody>
    </table>

    <div class="pagination" th:if="${patients.totalPages > 0}">
        <a th:href="@{/patients(page=${patients.number - 1}, keyword=${keyword})}" th:if="${!patients.first}">ì´ì „</a>
        <span th:each="i : ${#numbers.sequence(0, patients.totalPages - 1)}">
            <a th:href="@{/patients(page=${i}, keyword=${keyword})}" th:text="${i + 1}" th:class="${i == patients.number} ? 'active' : ''"></a>
        </span>
        <a th:href="@{/patients(page=${patients.number + 1}, keyword=${keyword})}" th:if="${!patients.last}">ë‹¤ìŒ</a>
    </div>
</div>
</body>
</html>